//Created by Kuznetsov Pavel (C) 2012 - kuznetps@gmail.com
function makeUpload(){myframe="<iframe style='display:none;' class='myload' src='frames/iframe.html'></iframe>";$("body").append(myframe);$('body').append(' <input style="display:none;" onclick="fchange(this.value)" type="text" id="status"/>');}
function makeVisual(cont){makeUpload()
$("#"+cont).attr('id','files');$('#load_ul').append('<div id="r" style="display:none;">12</div><ul id="filelist"></ul>');}
function makeStartUpload(cont){$("#"+cont).attr('id','startLoad');}
function fchange(fname){if(fname.trim()!=''){$('ul#filelist').append('<li style="cursor:pointer" title="'+file_col+'" id="flist_item"><a>'+fname+'</a> <img  style="display:none;" src="load.gif"/></li>');letitload(file_col);file_col++;}}
var flist=new Array()
var file_num=1;var file_col=0;function letitload(num){a=($("#filelist #flist_item[title="+num+"]").children('a').html());b=$("#filelist #flist_item[title="+num+"]");b.children('img').show();loadfile(a,b);}
function loadfile(fname,obj){frame=$(".myload");function setfname(){frame.contents().find('#pushme').val(fname);frame.contents().find('#num').val(obj.attr('title'));}
function fsubmit(){frame.contents().find('#loadf').submit();}
setfname();fsubmit();}
function loadnext(){if($('#r').html()=='1'){$('#filelist #flist_item[title='+$("#r").attr('title')+']').css('color','green');$('#filelist #flist_item[title='+$("#r").attr('title')+']').children('img').hide(500);$('#filelist #flist_item[title='+$("#r").attr('title')+']').attr('no','0');$('#filelist #flist_item[title='+$("#r").attr('title')+']').attr('fname',$("#r").attr('fname'));f=flist[file_num];}else{$('#filelist #flist_item[title='+$("#r").attr('title')+']').css('color','red');$('#filelist #flist_item[title='+$("#r").attr('title')+']').children('img').hide(500);$('#filelist #flist_item[title='+$("#r").attr('title')+']').attr('title',$('#r').html());}}
$(document).ready(function(){makeVisual('load_button');$("#startLoad").live('click',function(){letitload();})
$('#files').live('click',function(){$('.myload').contents().find('#pushme').click();});$("#filelist #flist_item").live('click',function(){$(".myload").attr('src','frames/iframe.html');if($(this).children('img').is(':visible')){$(this).remove();}});$("#r").live('click',function(){loadnext();});});