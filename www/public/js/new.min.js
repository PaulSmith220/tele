// (C)2012 Paul Smith

$(document).ready(function(){$('#comps').click(function(){$('ul#comps').slideToggle(500);if($(this).attr('onme')=='1'){$(this).attr('onme','0');$(this).css('font-weight','normal');}else{$(this).attr('onme','1');$(this).css('font-weight','bold');}});$(".ln").click(function(){$(this).next().slideToggle(500);});$("#anamnesis").change(function(){$(this).css('color','darkgreen');$(this).attr('changed','1');$(this).css('text-shadow',' 0px 0px 2px blue');});$("#anam").click(function(){$("#anamnesis").slideToggle(500);if($(this).attr('onme')=='1'){$(this).attr('onme','0');$(this).css('font-weight','normal');}else{$(this).attr('onme','1');$(this).css('font-weight','bold');}});$("ul li ul li a").click(function(){if($(this).attr('class')=='0'){$(this).attr('class','1');$(this).css('color','green');}else{$(this).attr('class','0');$(this).css('color','');}});$('#obj').click(function(){$('ul#obj_ul').slideToggle(500);if($(this).attr('onme')=='1'){$(this).attr('onme','0');$(this).css('font-weight','normal');}else{$(this).attr('onme','1');$(this).css('font-weight','bold');}});$('#neuro').click(function(){$('ul#neuro').slideToggle(500);if($(this).attr('onme')=='1'){$(this).attr('onme','0');$(this).css('font-weight','normal');}else{$(this).attr('onme','1');$(this).css('font-weight','bold');}});$('#local').click(function(){$('ul#local').slideToggle(500);if($(this).attr('onme')=='1'){$(this).attr('onme','0');$(this).css('font-weight','normal');}else{$(this).attr('onme','1');$(this).css('font-weight','bold');}});$('#poly').click(function(){$('ul#poly').slideToggle(500);if($(this).attr('onme')=='1'){$(this).attr('onme','0');$(this).css('font-weight','normal');}else{$(this).attr('onme','1');$(this).css('font-weight','bold');}});$('#lech').click(function(){$('ul#heal').slideToggle(500);if($(this).attr('onme')=='1'){$(this).attr('onme','0');$(this).css('font-weight','normal');}else{$(this).attr('onme','1');$(this).css('font-weight','bold');}});$("#ready").click(function(){header=$("#result textarea").val();complaints='';anamnesis='';objectively='';neurostate='';localstate='';polyorg='';healing='';operations='';recomendations='';out='';atout='';dopinfo='';i=0;r='';$("ul#comps a.1").each(function(){i++;r+='- '+$(this).html()+"<br>";});if(i>0){complaints+="</b><b>Пациент поступил с жалобами на:</b><br>"+r;}
rr=/\n/g;an=$("#anamnesis").val().replace(rr,"<br>");if($("#anamnesis").attr('changed')=='1'){anamnesis+="<b>Анамнез:</b><br>";anamnesis+='<i>'+an+'</i>';anamnesis+="<br>";anamnesis+="<p>";}
i=0;r='';$("ul#obj_ul a.1").each(function(){i++;r+='<font color=green>'+$(this).attr('title')+':</font> '+$(this).html()+"<br>";});if(i>0)objectively+="<b>Объективно:</b> <br>"+r;objectively+="<p>";i=0;r='';$("ul#neuro a.1").each(function(){i++;r+='<font color=blue>'+$(this).attr('title')+':</font> '+$(this).html()+"<br>";});if(i>0)neurostate+="<b>Невростатус:</b> <br>"+r;neurostate+="<p>";i=0;r='';$("ul#local a.1").each(function(){i++;r+='<font color=maroon>'+$(this).attr('title')+':</font> '+$(this).html()+"<br>";});if(i>0)localstate+="<b>Локальный статус:</b> <br>"+r;localstate+="<p>";nn='<table>';$("ul#poly a.0").each(function(){nn+='<tr><td><font color=#614f07>'+$(this).attr('title')+'</font> : </td><td>'+$(this).children('select').val()+'</td></tr>';});ball=0;for(i=1;i<=6;i++){s=$("select."+i).val();b=s[0]-1;ball+=b;}
if(ball==0||(ball>=5&&ball<=20))sk='баллов';if(ball==1||ball==21)sk='балл';if((ball>=2&&ball<=4)||(ball>=22&&ball<=24))sk='балла';pr=(ball/24)*100;pr_bar='<div style="display:inline-block;overflow:hidden;margin-left:20px;width:100px;border-radius:5px;height:10px;border:1px solid grey;background:rgb(0,100,0);text-align: left;" id="pbar"><div id="pr" style="border-right:4px solid white;background:rgb(150,0,0);height:10px;width:'+pr+'%;"></div> </div>';polyorg+="<div><b>Полиорганная дисфункция (SOFA):<u><font color=red size=2> "+ball+"</font> "+sk+"</u></b> "+pr_bar+"</div><br>"+nn+"</table>";if($("#poly_check").attr("checked")==undefined)polyorg='';i=0;r='';$("ul#heal a.1").each(function(){i++;r+='<font color=green>'+$(this).attr('title')+':</font> '+$(this).html()+"<br>";});if(i>0)objectively+="<b>Лечение:</b> <br>"+r;objectively+="<p>";rr=/\n/g;if($("#dop").val()!='')
dopinfo+="<b>Дополнитеьная информация:</b> <br>"+$("#dop").val().replace(rr,"<br>")+"<p>";r='';i=0;res=header+complaints+anamnesis+objectively+neurostate+localstate+healing+operations+recomendations+out+atout+dopinfo+polyorg;res+='<hr> <br>';var iFrameDOM=$("#fr").contents();s=iFrameDOM.find("#fnamebox").html();if(s!=undefined){if(s.length>0){m=s.split('|');i=m.length;karts='';for(i=1;i<=m.length-1;i++)
if(m[i].substring(m[i].lastIndexOf('.')+1,m[i].length).toLowerCase()=='pdf'){karts+="<br><a target=_blank href='/public/upload_pdf/"+m[i]+"'><img width='32' src='/public/img/pdf.ico' />"+m[i]+"</a><br>";}else if(m[i].substring(m[i].lastIndexOf('.')+1,m[i].length).toLowerCase()=='PDF'){karts+="<br><a target=_blank href='/public/upload_pdf/"+m[i]+"'><img width='32' src='/public/img/pdf.ico' />"+m[i]+"</a><br>";}else
karts+="<br><img width='32' src='/public/upload/"+m[i]+"_thumb.jpg' /><a class='simg'>"+m[i]+"</a><div style='display:none;font-size:70%;'> Нажмите на картинку,чтобы скачать<br><a href='/public/upload/"+m[i]+".jpg'><img title='Скачать' src='/public/upload/"+m[i]+".jpg'/></a></div><br>";}
$("#kart").html(karts);}
$("#otchet").html(res);CKEDITOR.instances.otchet.setData(res);$("#send").show();$("#send").animate({'opacity':1.0},500);});$(".simg").click(function(){$(this).next().slideToggle(500);});$("#send").click(function(){abc=(CKEDITOR.instances['otchet'].getData());String.prototype.trim=function(){return this.replace(/^\s\s*/,'').replace(/\s\s*$/,'');};$("#sending").show();bcd=abc.trim();rr=/\n/g;bcd=bcd.replace(rr,"");$("#pform input[name=who]").val($("select#adresat").val().trim());$("#pform input[name=from]").val($("#from").val().trim());$("#pform input[name=karts]").val($("#kart").val().trim());$("#pform input[name=i]").val(bcd);$("#pform").submit();});})